# JavaScript 作用域与作用域链

## 作用域（Scope）

1. 什么是作用域?
   作用域指的是你有权访问的变量， 对象， 函数的集合。作用域决定了你代码区块中变量和其他资源的可见性。
   作用域最大的用处是隔离变量，不同作用域下面的同名变量不会有冲突。

2. 全局作用域与函数作用域

- 全局作用域

  在代码中任何地方都能访问到的对象拥有全局作用域。比如最外层函数，最外层变量。

  `window`对象的内置属性拥有全局作用域。

- 函数作用域

  函数作用域，是指在函数内部声明的变量函数的集合。只有在该函数内部才可以访问到。

  内层作用域可以访问外层作用域，反之则不行。

  块语句不会创建新的作用域。在块语句中定义的变量将保留他们已经存在的作用域中。

3. 块级作用域
   块级作用域可通过新增命令`let`和`const`声明， 所声明的变量在指定块的作用域外无法被访问。块级作用域在如下情况被创建：

- 在一个函数的内部
- 在一个代码块（由一对花括号包裹）内部

4. 作用域链
   > 作用域链本质上是一个指向当前环境与上层环境的一系列变量对象的指针列表（它只引用但不实际包含变量对象），作用域链保证了当前执行环境对符合访问权限的变量和函数的有序访问。

在一个作用域中访问一个变量，如果这个变量没有在该作用域声明，此时就会往该作用域的上一级作用域（即创建该函数的作用域）去找。取到的值为离自己最近的作用域里的值。

这样就形成了一个链式结构。

## 上下文（Context）

1. 什么是上下文？
   当代码运行时，会产生一个对应的执行环境，在这个环境中，所有变量会被事先提出来（变量提升），有的直接赋值，有的为默认值`undefined`，代码从上往下执行，就叫做执行上下文。

JS 中有三种运行环境：

- 全局环境：代码首先进入的环境
- 函数环境：函数被调用时执行的环境
- `eval`函数

执行上下文栈会存储执行环境，执行全局代码是，全局环境首先会被压入栈中，之后执行到函数时，会向栈中压入一个函数的上下文环境，执行完毕则被退出上下文栈。函数每被执行一次就会创建一个执行上下文然后入栈。

- 执行上下文生命周期

  1. 创建阶段

     (1) 生成变量对象

     (2) 建立作用域链

     (3) 确认`this`指向

  2. 执行阶段

     (1) 变量赋值

     (2) 函数引用

     (3) 执行其他代码

  3. 销毁阶段

     执行完毕出栈, 等待回收被销毁

2. 上下文与作用域的关系？
   `JavaScript`代码执行过程分为两个阶段：

- 代码解释阶段：由编译器完成，将代码翻译成可执行代码。
- 代码执行阶段：有引擎完成，主要任务是执行可执行代码。

解释阶段

- 词法分析
- 语法分析
- 作用域规则确定

执行阶段

- 创建执行上下文
- 执行函数代码
- 垃圾回收

作用域在函数定义时被确定，执行上下文是在函数执行之前创建的。

作用域和执行上下文之间最大的区别是： **执行上下文在运行时确定，随时可能改变；作用域在定义时就确定，并且不会改变。**

## 参考文章

[深入理解 JavaScript 作用域和作用域链](https://juejin.im/post/6844903797135769614#heading-2)
[执行上下文及其生命周期](https://www.jianshu.com/p/a6e8d2bf1ca0)
